{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Email Change Verification Page - Login Style */
.verify-email-change-section {
    min-height: calc(100vh - 200px);
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 80px 5% 80px;
    position: relative;
    overflow: hidden;
}

.verify-email-change-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-hero);
    opacity: 0.1;
    z-index: -1;
}

.verify-email-change-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 80px;
    max-width: 1200px;
    width: 100%;
    align-items: center;
    margin-top: 40px;
}

.verify-email-change-content {
    z-index: 1;
    margin-top: -80px;
}

.verify-email-change-title {
    font-family: 'Orbitron', monospace;
    font-weight: 900;
    font-size: 3.5rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 20px;
    position: relative;
    z-index: 1;
}

.verify-email-change-subtitle {
    font-size: 1.3rem;
    color: var(--text-secondary);
    margin-bottom: 30px;
    font-weight: 300;
    line-height: 1.6;
}

.verify-email-change-description {
    margin-bottom: 40px;
}

.verify-email-change-description p {
    font-size: 1.1rem;
    color: var(--text-secondary);
    margin-bottom: 15px;
    line-height: 1.6;
}

.verify-email-change-form-container {
    background: rgba(26, 26, 26, 0.8);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    padding: 40px;
    box-shadow: var(--shadow-card);
    position: relative;
    overflow: hidden;
    margin-top: -20px;
}

.verify-email-change-form-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-primary);
    opacity: 0.05;
    z-index: -1;
}

.verification-icon {
    text-align: center;
    margin-bottom: 30px;
}

.verification-icon svg {
    width: 60px;
    height: 60px;
    color: var(--neon-purple);
    filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.5));
}

.info-message {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    color: var(--text-primary);
    padding: 16px 20px;
    border-radius: 12px;
    font-size: 0.95rem;
    margin-bottom: 25px;
    position: relative;
    backdrop-filter: blur(10px);
}

.info-message strong {
    color: var(--neon-blue);
    font-weight: 600;
}

.info-message::before {
    content: 'ğŸ“§';
    margin-left: 8px;
    font-size: 1.1rem;
}

.form-group {
    margin-bottom: 25px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-primary);
    font-weight: 500;
    font-size: 0.95rem;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 15px 20px;
    background: rgba(10, 10, 10, 0.6);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    color: var(--text-primary);
    font-size: 1rem;
    transition: all var(--transition-medium);
    backdrop-filter: blur(10px);
    text-align: center;
    letter-spacing: 2px;
    font-weight: 600;
    font-family: 'Orbitron', monospace;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--neon-purple);
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    background: rgba(10, 10, 10, 0.8);
}

.form-group input::placeholder,
.form-group textarea::placeholder {
    color: var(--text-secondary);
    letter-spacing: 1px;
}

.verify-email-change-button {
    width: 100%;
    padding: 16px 32px;
    background: var(--gradient-button);
    border: none;
    border-radius: 50px;
    color: white;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all var(--transition-medium);
    position: relative;
    overflow: hidden;
    margin-top: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.verify-email-change-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left var(--transition-medium);
}

.verify-email-change-button:hover::before {
    left: 100%;
}

.verify-email-change-button:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

.back-link {
    text-align: center;
    margin-top: 25px;
}

.back-link a {
    color: var(--neon-blue);
    text-decoration: none;
    font-weight: 500;
    transition: color var(--transition-medium);
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.back-link a:hover {
    color: var(--neon-purple);
}

.back-link a svg {
    width: 16px;
    height: 16px;
    transition: transform var(--transition-medium);
}

.back-link a:hover svg {
    transform: translateX(-3px);
}

.error-message {
    margin-top: 8px;
    color: #ef4444;
    font-size: 0.85rem;
    font-weight: 500;
}

.error-message span {
    display: block;
    margin-bottom: 4px;
}

.resend-section {
    text-align: center;
    margin-top: 25px;
    padding-top: 20px;
    border-top: 1px solid rgba(139, 92, 246, 0.1);
}

.resend-text {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 10px;
}

.resend-btn {
    background: transparent;
    border: 2px solid var(--neon-purple);
    color: var(--neon-purple);
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all var(--transition-medium);
    font-weight: 500;
}

.resend-btn:hover {
    background: var(--neon-purple);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

.resend-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

/* Countdown Timer Styles */
.countdown-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
    padding: 10px;
    background: rgba(139, 92, 246, 0.1);
    border-radius: 8px;
    border: 1px solid rgba(139, 92, 246, 0.2);
}

.countdown-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.countdown-timer {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--neon-purple);
    font-family: 'Orbitron', monospace;
    text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
}

.countdown-timer.expired {
    color: #ef4444;
    animation: pulse 1s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.verify-email-change-benefits {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 40px;
}

.verify-email-change-benefit {
    background: rgba(26, 26, 26, 0.6);
    border: 1px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    transition: all var(--transition-medium);
}

.verify-email-change-benefit:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-hover);
    border-color: var(--neon-purple);
}

.verify-email-change-benefit-icon {
    width: 40px;
    height: 40px;
    margin: 0 auto 15px;
    color: var(--neon-purple);
}

.verify-email-change-benefit h4 {
    color: var(--text-primary);
    font-size: 1rem;
    margin-bottom: 8px;
}

.verify-email-change-benefit p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.4;
}

@media (max-width: 1024px) {
    .verify-email-change-container {
        grid-template-columns: 1fr;
        gap: 40px;
        margin-top: 20px;
    }
    
    .verify-email-change-content {
        order: -1;
        margin-top: 0;
        margin-bottom: 20px;
    }
    
    .verify-email-change-form-container {
        margin-top: 0;
    }
    
    .verify-email-change-title {
        font-size: 3rem;
    }
}

@media (max-width: 768px) {
    .verify-email-change-section {
        padding: 60px 5% 60px;
    }
    
    .verify-email-change-title {
        font-size: 2.5rem;
    }
    
    .verify-email-change-subtitle {
        font-size: 1.1rem;
    }
    
    .verify-email-change-form-container {
        padding: 30px 20px;
    }
    
    .verify-email-change-benefits {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .verify-email-change-section {
        padding: 40px 5% 40px;
    }
    
    .verify-email-change-title {
        font-size: 2rem;
    }
    
    .verify-email-change-form-container {
        padding: 25px 15px;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Particle Background -->
<div class="particle-bg" id="particleBg"></div>

<!-- Email Change Verification Section -->
<section class="verify-email-change-section">
    <div class="verify-email-change-container">
        <div class="verify-email-change-form-container">
            <div class="verification-icon">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <path d="M22 4L12 14.01l-3-3"/>
                </svg>
            </div>
            <div class="info-message">
                Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø¨Ù‡ Ø§ÛŒÙ…ÛŒÙ„ <strong>{{ email }}</strong> Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:
                <br><br>
                <div class="countdown-container">
                    <span class="countdown-label">Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡:</span>
                    <span class="countdown-timer" id="countdownTimer">{{ remaining_time }}</span>
                </div>
            </div>
            <form id="verifyForm" method="post" autocomplete="off">
                {% csrf_token %}
                {% if form.non_field_errors %}
                    <div class="error-message" id="formError">
                        {% for error in form.non_field_errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="error-message" id="formError" style="display:none;"></div>
                {% endif %}
                <div class="form-group">
                    <label for="{{ form.code.id_for_label }}">{{ form.code.label }}</label>
                    {{ form.code }}
                    {% if form.code.errors %}
                        <div class="error-message">
                            {% for error in form.code.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <button type="submit" class="verify-email-change-button">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 12l2 2 4-4"/>
                        <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"/>
                    </svg>
                    <span>ØªØ§ÛŒÛŒØ¯ Ùˆ ØªØºÛŒÛŒØ± Ø§ÛŒÙ…ÛŒÙ„</span>
                </button>
            </form>
            <!-- Resend Code Section -->
            <div class="resend-section">
                <div class="resend-text">Ú©Ø¯ Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ù†Ú©Ø±Ø¯ÛŒØ¯ØŸ</div>
                <button type="button" class="resend-btn" id="resendBtn" disabled>Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯</button>
                <div id="resendErrorMsg" style="color:#ef4444; text-align:center; margin-top:10px; display:none;"></div>
            </div>
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Prevent browser from saving form data
                const form = document.getElementById('verifyForm');
                if (form) {
                    form.setAttribute('autocomplete', 'off');
                    Array.from(form.elements).forEach(function(el) {
                        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                            el.setAttribute('autocomplete', 'off');
                            el.setAttribute('autocorrect', 'off');
                            el.setAttribute('autocapitalize', 'off');
                            el.setAttribute('spellcheck', 'false');
                        }
                    });
                }
                // Add form input styling and particle background
                const inputs = document.querySelectorAll('input[type="text"]');
                inputs.forEach(input => {
                    input.classList.add('form-input');
                    input.placeholder = 'Ú©Ø¯ 6 Ø±Ù‚Ù…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯';
                });
                // Create particle background
                const particleBg = document.getElementById('particleBg');
                if (particleBg) {
                    for (let i = 0; i < 50; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.top = Math.random() * 100 + '%';
                        particle.style.animationDelay = Math.random() * 3 + 's';
                        particle.style.animationDuration = (Math.random() * 3 + 2) + 's';
                        particleBg.appendChild(particle);
                    }
                }
                const resendBtn = document.getElementById('resendBtn');
                const countdownTimer = document.getElementById('countdownTimer');
                const TIMER_KEY = 'vf_email_change_verification_last_sent';
                const TIMER_DURATION = 120; // seconds
                const originalText = resendBtn ? resendBtn.textContent : '';
                function getRemainingSeconds() {
                    const lastSent = parseInt(localStorage.getItem(TIMER_KEY) || '0', 10);
                    const now = Math.floor(Date.now() / 1000);
                    const diff = now - lastSent;
                    return Math.max(0, TIMER_DURATION - diff);
                }
                if (!localStorage.getItem(TIMER_KEY)) {
                    const backendSeconds = parseInt('{{ remaining_seconds|default:0 }}') || 0;
                    if (backendSeconds > 0) {
                        const now = Math.floor(Date.now() / 1000);
                        localStorage.setItem(TIMER_KEY, now - (TIMER_DURATION - backendSeconds));
                    }
                }
                function updateResendBtnAndCountdown() {
                    let remaining = getRemainingSeconds();
                    if (remaining > 0) {
                        resendBtn.disabled = true;
                        resendBtn.textContent = `${remaining} Ø«Ø§Ù†ÛŒÙ‡`;
                        if (countdownTimer) {
                            const minutes = Math.floor(remaining / 60);
                            const seconds = remaining % 60;
                            countdownTimer.textContent = `${minutes > 0 ? minutes + ' Ø¯Ù‚ÛŒÙ‚Ù‡ Ùˆ ' : ''}${seconds} Ø«Ø§Ù†ÛŒÙ‡`;
                            countdownTimer.classList.remove('expired');
                        }
                        const interval = setInterval(() => {
                            remaining = getRemainingSeconds();
                            if (remaining > 0) {
                                resendBtn.textContent = `${remaining} Ø«Ø§Ù†ÛŒÙ‡`;
                                if (countdownTimer) {
                                    const minutes = Math.floor(remaining / 60);
                                    const seconds = remaining % 60;
                                    countdownTimer.textContent = `${minutes > 0 ? minutes + ' Ø¯Ù‚ÛŒÙ‚Ù‡ Ùˆ ' : ''}${seconds} Ø«Ø§Ù†ÛŒÙ‡`;
                                    countdownTimer.classList.remove('expired');
                                }
                            } else {
                                resendBtn.disabled = false;
                                resendBtn.textContent = originalText;
                                if (countdownTimer) {
                                    countdownTimer.textContent = 'Û°';
                                    countdownTimer.classList.add('expired');
                                }
                                clearInterval(interval);
                            }
                        }, 1000);
                    } else {
                        resendBtn.disabled = false;
                        resendBtn.textContent = originalText;
                        if (countdownTimer) {
                            countdownTimer.textContent = 'Û°';
                            countdownTimer.classList.add('expired');
                        }
                    }
                }
                updateResendBtnAndCountdown();
                if (resendBtn) {
                    resendBtn.addEventListener('click', function() {
                        if (getRemainingSeconds() > 0 || resendBtn.disabled) {
                            return;
                        }
                        resendBtn.disabled = true;
                        resendBtn.textContent = `${TIMER_DURATION} Ø«Ø§Ù†ÛŒÙ‡`;
                        localStorage.setItem(TIMER_KEY, Math.floor(Date.now() / 1000));
                        updateResendBtnAndCountdown();
                        fetch("{% url 'accounts:ajax_resend_verification_code' %}", {
                            method: 'POST',
                            headers: {
                                'X-CSRFToken': '{{ csrf_token }}',
                                'Content-Type': 'application/x-www-form-urlencoded'
                            },
                            body: new URLSearchParams({
                                'flow': 'email_change',
                                'uid': '{{ uidb64 }}',
                                'token': '{{ token }}'
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                // Optionally show a message
                            } else if (data.remaining) {
                                localStorage.setItem(TIMER_KEY, Math.floor(Date.now() / 1000) - (TIMER_DURATION - data.remaining));
                                updateResendBtnAndCountdown();
                            }
                        })
                        .catch(() => {
                            resendBtn.disabled = false;
                            resendBtn.textContent = originalText;
                            updateResendBtnAndCountdown();
                        });
                    });
                }
            });
            </script>
            <div class="back-link">
                <a href="{% url 'accounts:profile' %}">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
                </a>
            </div>
        </div>
        <div class="verify-email-change-content">
            <div class="logo-container">
                <div class="logo-glow"></div>
                <h1 class="verify-email-change-title">ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„ Ø¬Ø¯ÛŒØ¯</h1>
                <div class="verify-email-change-subtitle">Ú©Ø¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</div>
            </div>
            <div class="verify-email-change-description">
                <p>Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø¨Ù‡ Ø§ÛŒÙ…ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§ÛŒÙ† Ú©Ø¯ Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø§ÛŒÙ…ÛŒÙ„ Ø´Ù…Ø§ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª.</p>
                <p>Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ 6 Ø±Ù‚Ù…ÛŒ Ø±Ø§ Ú©Ù‡ Ø¯Ø± Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</p>
            </div>
            <div class="verify-email-change-benefits">
                <div class="verify-email-change-benefit">
                    <div class="verify-email-change-benefit-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                    </div>
                    <h4>Ø§Ù…Ù†ÛŒØª Ø¨Ø§Ù„Ø§</h4>
                    <p>Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§ÙØ¸Øª Ø§Ø² Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø´Ù…Ø§</p>
                </div>
                <div class="verify-email-change-benefit">
                    <div class="verify-email-change-benefit-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"/>
                            <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"/>
                        </svg>
                    </div>
                    <h4>ØªØ§ÛŒÛŒØ¯ Ø³Ø±ÛŒØ¹</h4>
                    <p>ÙØ±Ø¢ÛŒÙ†Ø¯ ØªØ§ÛŒÛŒØ¯ Ø³Ø±ÛŒØ¹ Ùˆ Ø¢Ø³Ø§Ù†</p>
                </div>
                <div class="verify-email-change-benefit">
                    <div class="verify-email-change-benefit-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <h4>Ø§Ù†Ù‚Ø¶Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±</h4>
                    <p>Ú©Ø¯ Ù¾Ø³ Ø§Ø² 2 Ø¯Ù‚ÛŒÙ‚Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
                </div>
                <div class="verify-email-change-benefit">
                    <div class="verify-email-change-benefit-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                    </div>
                    <h4>Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯</h4>
                    <p>Ø§Ù…Ú©Ø§Ù† Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯ Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %} 