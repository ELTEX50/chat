{% extends "admin/base_site.html" %}
{% load static %}
{% load jalali_filters %}

{% block title %}{{ title }} - مدیریت PIMXCHAT{% endblock %}

{% block content %}
<div class="admin-card">
    <div class="card-header">
        <div class="card-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 11H1l8-8 8 8h-8v8"/>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7"/>
            </svg>
        </div>
        <h3 class="card-title">{{ title }}</h3>
    </div>
    
    {% if cl.result_count %}
    <div class="admin-item">
        <div class="admin-info">
            <div class="admin-label">تعداد رکوردها</div>
            <div class="admin-description-text">{{ cl.result_count }} رکورد یافت شد</div>
        </div>
        <div class="admin-control">
            <a href="{% url 'admin:accounts_user_add' %}" class="admin-btn">
                <span>افزودن جدید</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
            </a>
        </div>
    </div>
    
    <!-- Bulk Actions -->
    <div style="background: rgba(17, 17, 17, 0.8); border-radius: 10px; padding: 20px; margin: 20px 0;">
        <h4 style="color: var(--text-primary); margin-bottom: 15px;">عملیات گروهی</h4>
        <form method="post" id="changelist-form">
            {% csrf_token %}
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                <select name="action" style="background: rgba(10, 10, 10, 0.6); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: #e5e7eb; padding: 8px 12px; font-family: 'Inter', sans-serif;">
                    <option value="">انتخاب عملیات...</option>
                    <option value="activate_users">فعال کردن کاربران انتخاب شده</option>
                    <option value="deactivate_users">غیرفعال کردن کاربران انتخاب شده</option>
                    <option value="verify_users">تایید کاربران انتخاب شده</option>
                    <option value="unverify_users">عدم تایید کاربران انتخاب شده</option>
                    <option value="clear_user_chat">پاک کردن پیام‌های چت کاربران انتخاب شده</option>
                </select>
                <button type="submit" class="admin-btn" onclick="return confirm('آیا مطمئن هستید؟')">
                    <span>اجرای عملیات</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 13l4 4L19 7"/>
                    </svg>
                </button>
            </div>
        </form>
    </div>
    
    <div style="background: rgba(17, 17, 17, 0.8); border-radius: 10px; padding: 20px; margin: 20px 0; overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; font-family: 'Inter', sans-serif;">
            <thead>
                <tr style="background: var(--gradient-primary); color: white;">
                    <th style="padding: 12px; text-align: center; font-weight: 600; width: 50px;">
                        <input type="checkbox" id="select-all" style="transform: scale(1.2);">
                    </th>
                    {% for field in cl.list_display %}
                    <th style="padding: 12px; text-align: right; font-weight: 600;">{{ field|title }}</th>
                    {% endfor %}
                    <th style="padding: 12px; text-align: center; font-weight: 600;">عملیات</th>
                </tr>
            </thead>
            <tbody>
                {% for result in cl.result_list %}
                <tr style="border-bottom: 1px solid rgba(139, 92, 246, 0.1);">
                    <td style="padding: 12px; text-align: center;">
                        <input type="checkbox" name="_selected_action" value="{{ result.id }}" form="changelist-form" style="transform: scale(1.2);">
                    </td>
                    {% for field in cl.list_display %}
                    <td style="padding: 12px; color: var(--text-primary);">
                        {% if field == 'id' %}
                            {{ result.id }}
                        {% elif field == 'username' %}
                            {{ result.username }}
                        {% elif field == 'email' %}
                            {{ result.email }}
                        {% elif field == 'first_name' %}
                            {{ result.first_name|default:"-" }}
                        {% elif field == 'last_name' %}
                            {{ result.last_name|default:"-" }}
                        {% elif field == 'is_active' %}
                            {% if result.is_active %}
                                <span style="color: #10b981;">فعال</span>
                            {% else %}
                                <span style="color: #ef4444;">غیرفعال</span>
                            {% endif %}
                        {% elif field == 'date_joined' %}
                            {{ result.date_joined|date:"Y/m/d" }}
                        {% elif field == 'last_login' %}
                            {{ result.last_login|date:"Y/m/d H:i"|default:"-" }}
                        {% else %}
                            {{ result|getattr_filter:field|default:"-" }}
                        {% endif %}
                    </td>
                    {% endfor %}
                    <td style="padding: 12px; text-align: center;">
                        <div style="display: flex; gap: 8px; justify-content: center;">
                            <a href="{% url 'admin:accounts_user_change' result.id %}" class="admin-btn" style="padding: 4px 8px; font-size: 0.8rem;">
                                <span>ویرایش</span>
                            </a>
                            <a href="{% url 'admin:accounts_user_delete' result.id %}" class="admin-btn" style="padding: 4px 8px; font-size: 0.8rem; background: linear-gradient(135deg, #dc2626, #b91c1c);">
                                <span>حذف</span>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="admin-item">
        <div class="admin-info">
            <div class="admin-label">هیچ رکوردی یافت نشد</div>
            <div class="admin-description-text">در حال حاضر هیچ رکوردی در این بخش وجود ندارد</div>
        </div>
        <div class="admin-control">
            <a href="{% url 'admin:accounts_user_add' %}" class="admin-btn">
                <span>افزودن اولین رکورد</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
            </a>
        </div>
    </div>
    {% endif %}
</div>

<div class="admin-actions">
    <a href="{% url 'admin:index' %}" class="admin-action-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
        </svg>
        <span>داشبورد</span>
    </a>
    
    <a href="/" class="admin-action-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9,22 9,12 15,12 15,22"/>
        </svg>
        <span>صفحه اصلی</span>
    </a>
</div>

<script>
// Select all functionality
document.getElementById('select-all').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('input[name="_selected_action"]');
    checkboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
    });
});
</script>
{% endblock %} 